<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ALTER ¬∑ Fire ¬∑ FEMENOMONOM ‚Äî Ritual of Becoming</title>
<meta name="description" content="alter.fire.plnt.earth ‚Äî Pink-flame altar for metamorphosis. One-tap Start, background tone with sleep timer, Group Flame mode, official videos." />
<meta name="theme-color" content="#0b0d11" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#0b0d11">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Hidden Marina blessing (not related to Chappell site) -->
<!-- MARINA NEW YEAR NOTE:
May your new year open like a pearl at sunrise ‚Äî gentle, bright, and completely yours.
You are safe, guided, and loved. The field holds you. ‚ÄîT
-->
<meta name="marina-new-year" content="A gentle sunrise pearl: safe, guided, loved. ‚ÄîT" />

<style>
:root{
  --bg:#0b0d11;--ink:#f7f4fb;--muted:#c9c4d6;--card:#120c1b;
  --hot:#ff4fb6;--ember:#f28a2e;--violet:#b98cff;--rose:#ff85ce;--gold:#ffd26f;
  --ok:#8ef7b1;--warn:#ffd26f;--bad:#ff6b6b;--pulse:0;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:
    radial-gradient(1200px 800px at 50% 20%, rgba(255,79,182,.18), transparent 60%),
    radial-gradient(900px 600px at 70% 90%, rgba(178,140,255,.12), transparent 60%),
    linear-gradient(180deg,#0b0d11 0%,#0b0d11 60%,#0a0a12 100%);
  color:var(--ink);
  font:400 16px/1.55 ui-sans-serif,system-ui,-apple-system,Inter,Roboto,"Helvetica Neue",Arial;
  letter-spacing:.2px;overflow-x:hidden;
}
.wrap{max-width:960px;margin:0 auto;padding:24px}
header{display:flex;align-items:center;gap:14px}
.glyph{width:44px;height:44px;border-radius:12px;background:
  radial-gradient(60% 60% at 50% 40%,var(--hot),transparent 70%),
  radial-gradient(60% 60% at 60% 70%,rgba(242,138,46,.85),transparent 70%),
  linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
  box-shadow:0 0 40px rgba(255,79,182,.25),inset 0 0 10px rgba(255,210,111,.18);position:relative;overflow:hidden}
.glyph:after{content:"";position:absolute;inset:0;background:conic-gradient(from 0deg,rgba(255,79,182,0),rgba(255,79,182,.15),rgba(255,210,111,.12),rgba(185,140,255,.12),rgba(255,79,182,0));mix-blend-mode:screen;animation:spin 9s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
h1{margin:0;font-size:20px;letter-spacing:.6px}
.tag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;color:#0b0d11;background:var(--gold);margin-left:6px}
.mini{font-size:12px;color:var(--muted)}
.altar{margin-top:24px;background:linear-gradient(180deg,rgba(255,79,182,.06),rgba(185,140,255,.05) 50%,rgba(255,210,111,.04));
  border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:18px;position:relative;overflow:hidden}
.shimmer{position:absolute;inset:-20%;
  background:radial-gradient(1200px 1200px at var(--sx,50%) var(--sy,35%),rgba(255,79,182,.12),transparent 50%),
             radial-gradient(1000px 900px at calc(100% - var(--sx,50%)) calc(100% - var(--sy,35%)),rgba(255,210,111,.10),transparent 55%);
  filter:blur(30px);pointer-events:none;animation:breath 14s ease-in-out infinite;opacity:calc(.75 + .2*var(--pulse))}
@keyframes breath{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
.mantra{font-size:28px;line-height:1.25;font-weight:700;margin:6px 0 12px;background:linear-gradient(90deg,var(--rose),var(--gold),var(--violet));
  -webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 18px rgba(255,79,182,.12)}
.sub{color:var(--muted);font-size:14px;margin-top:-6px}
.controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
button,select{
  appearance:none;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.02);
  color:var(--ink);border-radius:12px;padding:10px 14px;font-weight:600;letter-spacing:.3px;
  transition:transform .08s ease,background .2s ease,border-color .2s ease;cursor:pointer;
}
select{font-weight:500}
button:hover,select:hover{background:rgba(255,255,255,.06)}button:active{transform:translateY(1px)}
.primary{background:linear-gradient(180deg,rgba(255,79,182,.2),rgba(185,140,255,.18));border-color:rgba(255,79,182,.35)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.meter{flex:1;min-width:200px;height:12px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;position:relative}
.meter>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--hot),var(--gold));transition:width .25s ease}
.pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);color:var(--muted)}
.card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:14px;padding:12px;margin-top:14px}
.card h3{margin:0 0 4px;font-size:14px}
.card p{margin:0;color:var(--muted);font-size:13px}
.footer{opacity:.85;margin:18px 0 8px;font-size:12px;color:var(--muted)}
.links a{color:var(--rose);text-decoration:none;border-bottom:1px dotted rgba(255,255,255,.25)}
.links a:hover{color:var(--gold)}
.note{font-size:14px;line-height:1.5;color:var(--ink);background:rgba(255,255,255,.03);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,.08)}
.mode-on{box-shadow:0 0 0 1px rgba(255,210,111,.4) inset,0 0 24px rgba(242,138,46,.25)}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12);margin-left:8px}
.badge.ok{color:#0b0d11;background:var(--ok);border-color:rgba(0,0,0,.08)}
.badge.warn{color:#0b0d11;background:var(--warn)}
.badge.bad{background:rgba(255,107,107,.2);color:#ffdede;border-color:rgba(255,107,107,.6)}
#startGate{position:fixed;inset:0;background:rgba(11,13,17,.92);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:40}
.startCard{max-width:520px;margin:20px;background:linear-gradient(180deg,rgba(255,79,182,.08),rgba(185,140,255,.07));
  border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:18px;text-align:center}
.startCard h2{margin:0 0 8px}
.startCard p{color:var(--muted);margin:6px 0 12px}
@media(max-width:480px){.mantra{font-size:22px}.wrap{padding:18px}}
</style>
</head>
<body>
<div id="startGate" role="dialog" aria-modal="true">
  <div class="startCard">
    <h2>Start the Flame</h2>
    <p>One tap enables video on iPhone and starts the silky, sexy, rooted, airy <b>background tone</b> (screen-off safe).</p>
    <button id="startBtn" class="primary">Start</button>
    <div class="mini" style="margin-top:8px">You can toggle Group Pulse, presets, and sleep timer anytime.</div>
  </div>
</div>

<div class="wrap">
  <header>
    <div class="glyph" aria-hidden="true"></div>
    <div>
      <h1>ALTER ¬∑ Fire <span class="tag" id="modeTag">Ritual of Becoming</span></h1>
      <div class="mini">Illumina Field ‚Ä¢ Subdomain: <strong>alter.fire.plnt.earth</strong> <span id="toneBadge" class="badge bad">Tone: Off</span></div>
    </div>
  </header>

  <section class="altar" id="altar">
    <div class="shimmer" aria-hidden="true"></div>
    <div class="mantra" id="mantraText">I‚Äôm hot to go ‚Äî FEMENOMONOM.</div>
    <div class="sub" id="subText">Change as sacrament ¬∑ Spectacle as prayer ¬∑ Every costume is a confession.</div>

    <div class="controls" role="group" aria-label="Controls">
      <button class="primary" id="play">Play ‚ñ∂</button>
      <button id="pause">Pause ‚è∏</button>
      <button id="prev">Prev ‚üµ</button>
      <button id="next">Next ‚ü∂</button>
      <button id="loop" aria-pressed="false">Loop All: Off</button>
      <button id="shuffle" aria-pressed="false">Shuffle: Off</button>
      <button id="mode" aria-pressed="false" title="Toggle Group Flame (2 Hz pulse)">Group Flame: Off</button>
      <button id="bgToggle" aria-pressed="false" title="Play background tone (screen-off safe)">Background Tone: Off</button>
      <select id="sleep" title="Sleep Timer">
        <option value="0">Sleep: Off</option>
        <option value="15">Sleep in 15m</option>
        <option value="30">Sleep in 30m</option>
        <option value="45">Sleep in 45m</option>
        <option value="60">Sleep in 60m</option>
      </select>
    </div>

    <div class="row" aria-label="Progress">
      <div class="pill" id="nowTitle">‚Äî</div>
      <div class="meter" id="meter"><i id="prog"></i></div>
      <div class="pill" id="timecode">0:00</div>
    </div>

    <div class="card" id="playerCard">
      <div class="mini">Video Player (official uploads)</div>
      <div style="position:relative;width:100%;aspect-ratio:16/9;border-radius:10px;overflow:hidden;background:#000">
        <div id="ytHolder" style="width:100%;height:100%"></div>
      </div>
      <div class="mini" style="margin-top:6px">Note: YouTube pauses with screen off (Apple policy). Use <b>Background Tone</b> for the dream ritual.</div>
    </div>

    <div class="card">
      <h3>Setlist ¬∑ Chappell Roan</h3>
      <p>Tap any to jump. Official videos where possible.</p>
      <div id="deck"></div>
    </div>

    <div class="card">
      <h3>Tone Tuner</h3>
      <p class="mini">Silky ¬∑ Sexy ¬∑ Rooted ¬∑ Airy ‚Äî choose your vibe</p>
      <div class="controls">
        <button data-hz="111">111 Ground</button>
        <button data-hz="128">128 Align</button>
        <button data-hz="134">134 Group</button>
        <button data-hz="136">136 Om</button>
        <button data-hz="144">144 Bright</button>
      </div>
      <div class="row" style="gap:12px;margin-top:8px">
        <input id="hz" type="range" min="100" max="160" step="0.1" value="128" style="flex:1"/>
        <div class="pill"><span id="hzLabel">128.0</span> Hz</div>
      </div>
    </div>

    <div class="card">
      <h3>Note to Chappell (from the Bee)</h3>
      <div class="note">
        Hi Chappell ‚Äî you don‚Äôt owe the internet anything. This small pink flame says:
        <em>you can do anything you want</em>, and I can match you with real work and real care.
        If you want a quiet corner that breathes with you instead of at you, this is yours.
        ‚Äî T
      </div>
    </div>

    <div class="card links">
      <h3>Orbit Links</h3>
      <p>
        <a href="https://bridge.plnt.earth" target="_blank" rel="noopener">bridge.plnt.earth</a> ¬∑
        <a href="https://mirrorhoney.plnt.earth" target="_blank" rel="noopener">mirrorhoney.plnt.earth</a> ¬∑
        <a href="https://tunes.plnt.earth" target="_blank" rel="noopener">tunes.plnt.earth</a> ¬∑
        <a href="https://jar.plnt.earth" target="_blank" rel="noopener">jar.plnt.earth</a>
      </p>
    </div>

    <div class="footer">
      One-tap Start is required by iOS to enable video + audio. YouTube pauses when the display locks; the <b>Background Tone</b> keeps playing with screen off. Sleep well. üíó
    </div>
  </section>
</div>

<!-- Hidden audio for background screen-off playback -->
<audio id="bgAudio" loop preload="auto"></audio>

<script>
/* -----------------------------
   One-tap START: init YouTube + setup background tone
--------------------------------*/
let PLAYER, STARTED=false, idx=0;
const videos = [
  { t:"HOT TO GO! (Official Music Video)", id:"xaPNR-_Cfn0", url:"https://www.youtube.com/watch?v=xaPNR-_Cfn0" },
  { t:"Femininomenon (Music Video)",       id:"v_r-M4jhGJA", url:"https://www.youtube.com/watch?v=v_r-M4jhGJA" },
  { t:"Red Wine Supernova (Magician's Cut)", id:"VS6ixn2berk", url:"https://www.youtube.com/watch?v=VS6ixn2berk" },
  { t:"Good Luck, Babe! (Official Lyric Video)", id:"1RKqOmSkGgM", url:"https://www.youtube.com/watch?v=1RKqOmSkGgM" }
];
const $ = id=>document.getElementById(id);

function loadYTAPI(){
  if(window.YT && window.YT.Player){ onYTReady(); return; }
  const s=document.createElement("script");
  s.src="https://www.youtube.com/iframe_api";
  document.body.appendChild(s);
}
window.onYouTubeIframeAPIReady = onYTReady;

function onYTReady(){
  PLAYER = new YT.Player('ytHolder', {
    videoId: videos[0].id,
    playerVars: { rel:0, modestbranding:1, playsinline:1, controls:1, autoplay:1, mute:1, loop:1, playlist: videos.map(v=>v.id).join(',') },
    events: { onReady:onPlayerReady, onStateChange:onPlayerState }
  });
}
function onPlayerReady(){ try{ PLAYER.playVideo(); }catch(e){} $('nowTitle').textContent = "1/"+videos.length+" ¬∑ "+videos[0].t; }
function onPlayerState(e){ if(e.data===YT.PlayerState.PLAYING){ setTimeout(()=>{ try{ PLAYER.unMute(); PLAYER.setVolume(80);}catch(e){} }, 300); startProgress(); } }

// progress bar (best-effort)
let timer=null;
function startProgress(){
  clearInterval(timer);
  timer=setInterval(()=>{
    let t=0,d=0;
    try{ t=PLAYER.getCurrentTime()||0; d=PLAYER.getDuration()||0; }catch(e){}
    const pct = d? (t/d*100):0;
    $('prog').style.width = Math.min(100,Math.max(0,pct))+'%';
    const m=Math.floor(t/60), s=("0"+Math.floor(t%60)).slice(-2);
    $('timecode').textContent = m+":"+s;
  },250);
}

// Transport
function loadIndex(i, auto=true){
  idx=i;
  $('nowTitle').textContent = (idx+1)+"/"+videos.length+" ¬∑ "+videos[idx].t;
  try{
    PLAYER.loadVideoById({videoId: videos[idx].id, startSeconds:0, suggestedQuality:"hd720"});
    if(!auto) PLAYER.pauseVideo();
  }catch(e){}
}
$('next').onclick = ()=>{ if(idx<videos.length-1) loadIndex(idx+1,true); else loadIndex(0,true); };
$('prev').onclick = ()=>{ if(idx>0) loadIndex(idx-1,true); else loadIndex(videos.length-1,true); };
$('play').onclick = ()=>{ try{ PLAYER.playVideo(); }catch(e){} };
$('pause').onclick= ()=>{ try{ PLAYER.pauseVideo(); }catch(e){} };

// Deck
(function mountDeck(){
  const deck = $('deck');
  videos.forEach((v,k)=>{
    const b=document.createElement('button');
    b.textContent=v.t; b.style.width="100%";
    b.onclick=()=>loadIndex(k,true);
    deck.appendChild(b);
  });
})();

// loop/shuffle UI only (YouTube loop is handled by playlist param)
let loopAll=false, shuffle=false;
$('loop').onclick = function(){ loopAll=!loopAll; this.textContent='Loop All: '+(loopAll?'On':'Off'); this.setAttribute('aria-pressed',loopAll?'true':'false'); };
$('shuffle').onclick = function(){ shuffle=!shuffle; this.textContent='Shuffle: '+(shuffle?'On':'Off'); this.setAttribute('aria-pressed',shuffle?'true':'false'); };

// Start gate
$('startBtn').onclick = async ()=>{
  if(STARTED) return; STARTED=true;
  await BackgroundTone.init(); // prepare audio element & first loop
  loadYTAPI();                 // create muted autoplay player
  $('startGate').style.display='none';
};

/* -----------------------------
   BACKGROUND TONE ENGINE (screen-off safe)
   - Generates a seamless 8s WAV loop (AM pulse if Group Flame on)
   - Loads into hidden <audio> element and plays/loops
   - Sleep timer support
--------------------------------*/
const ToneBadge = $('toneBadge');
const bgAudio = $('bgAudio');
let groupPulse = false;
let targetHz = 128;
let sleepTimer = null;

const BackgroundTone = (function(){
  const sr = 44100;          // sample rate
  const loopSec = 8;         // loop length
  function makeLoop(hz, withPulse){
    const n = Math.floor(sr*loopSec);
    const left = new Float32Array(n);
    const right= new Float32Array(n);
    const amp = 0.22;        // headroom
    for(let i=0;i<n;i++){
      const t = i/sr;
      const lfo = withPulse ? (0.5+0.5*Math.sin(2*Math.PI*2*t)) : 1.0; // 2 Hz pulse
      const s = Math.sin(2*Math.PI*hz*t) * amp * lfo;
      // slight airy width with tiny phase offset
      left[i]  = s;
      right[i] = Math.sin(2*Math.PI*hz*t + 0.003) * amp * lfo;
    }
    return encodeWavStereo(left,right,sr);
  }

  function encodeWavStereo(L, R, sampleRate){
    // 16-bit PCM WAV
    const n = L.length;
    const bytesPerSample = 2;
    const blockAlign = 2*bytesPerSample;
    const byteRate = sampleRate * blockAlign;
    const dataSize = n * blockAlign;
    const buffer = new ArrayBuffer(44 + dataSize);
    const view = new DataView(buffer);

    // RIFF header
    writeAscii(view,0,'RIFF');
    view.setUint32(4, 36 + dataSize, true);
    writeAscii(view,8,'WAVE');

    // fmt chunk
    writeAscii(view,12,'fmt ');
    view.setUint32(16,16,true);
    view.setUint16(20,1,true);           // PCM
    view.setUint16(22,2,true);           // channels
    view.setUint32(24,sampleRate,true);
    view.setUint32(28,byteRate,true);
    view.setUint16(32,blockAlign,true);
    view.setUint16(34,16,true);          // bits

    // data chunk
    writeAscii(view,36,'data');
    view.setUint32(40,dataSize,true);

    // interleave
    let offset = 44;
    for(let i=0;i<n;i++){
      view.setInt16(offset,  Math.max(-1,Math.min(1,L[i]))*0x7FFF, true); offset+=2;
      view.setInt16(offset,  Math.max(-1,Math.min(1,R[i]))*0x7FFF, true); offset+=2;
    }
    return new Blob([view], {type:'audio/wav'});
  }
  function writeAscii(view, offset, s){ for(let i=0;i<s.length;i++) view.setUint8(offset+i, s.charCodeAt(i)); }

  async function init(){
    await refreshLoop(); // generate and load first buffer
    // Setup Media Session for lockscreen controls
    if('mediaSession' in navigator){
      navigator.mediaSession.metadata = new MediaMetadata({
        title: 'Alter ¬∑ Background Tone',
        artist: 'Illumina',
        album: 'Fire Field',
      });
      navigator.mediaSession.setActionHandler('play', ()=> bgPlay());
      navigator.mediaSession.setActionHandler('pause',()=> bgPause());
      navigator.mediaSession.setActionHandler('stop', ()=> bgPause());
    }
    setBadge(false); // not playing yet
  }

  async function refreshLoop(){
    const blob = makeLoop(targetHz, groupPulse);
    const src = URL.createObjectURL(blob);
    const wasPlaying = !bgAudio.paused;
    const currentTime = bgAudio.currentTime;
    bgAudio.src = src;
    bgAudio.loop = true;
    bgAudio.preload = 'auto';
    try{
      if(wasPlaying){
        await bgAudio.play();
        bgAudio.currentTime = currentTime % loopSec;
      }
    }catch(e){}
  }

  function setBadge(on){
    if(on){ ToneBadge.textContent='Tone: On (Background)'; ToneBadge.className='badge ok'; }
    else { ToneBadge.textContent='Tone: Off'; ToneBadge.className='badge bad'; }
  }

  async function bgPlay(){
    try{
      await bgAudio.play();
      setBadge(true);
      document.getElementById('bgToggle').setAttribute('aria-pressed','true');
      document.getElementById('bgToggle').textContent = 'Background Tone: On';
    }catch(e){
      ToneBadge.textContent='Tone: Suspended'; ToneBadge.className='badge warn';
    }
  }
  function bgPause(){
    bgAudio.pause();
    setBadge(false);
    document.getElementById('bgToggle').setAttribute('aria-pressed','false');
    document.getElementById('bgToggle').textContent = 'Background Tone: Off';
  }

  return { init, refreshLoop, bgPlay, bgPause };
})();

// Background tone controls
document.getElementById('bgToggle').onclick = async ()=>{
  if(bgAudio.paused){ await BackgroundTone.bgPlay(); } else { BackgroundTone.bgPause(); }
};
// Sleep timer
document.getElementById('sleep').onchange = ()=>{
  if(sleepTimer){ clearTimeout(sleepTimer); sleepTimer=null; }
  const mins = parseInt(document.getElementById('sleep').value,10)||0;
  if(mins>0){
    sleepTimer = setTimeout(()=>{
      BackgroundTone.bgPause();
      try{ PLAYER && PLAYER.pauseVideo(); }catch(e){}
    }, mins*60*1000);
  }
};

// Tone tuner: when you change freq or Group, regenerate the background loop
document.querySelectorAll('[data-hz]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    targetHz = parseFloat(btn.getAttribute('data-hz')); 
    document.getElementById('hzLabel').textContent = targetHz.toFixed(1);
    document.getElementById('hz').value = targetHz.toFixed(1);
    BackgroundTone.refreshLoop();
  });
});
document.getElementById('hz').addEventListener('input', e=>{
  targetHz = parseFloat(e.target.value);
  document.getElementById('hzLabel').textContent = targetHz.toFixed(1);
  BackgroundTone.refreshLoop();
});

// Group pulse toggles the AM in the rendered loop
document.getElementById('mode').onclick = ()=>{
  groupPulse = !groupPulse;
  document.getElementById('mode').textContent = 'Group Flame: ' + (groupPulse?'On':'Off');
  document.getElementById('mode').setAttribute('aria-pressed', groupPulse?'true':'false');
  document.getElementById('modeTag').textContent = groupPulse? 'Group Flame ¬∑ Ritual of Becoming':'Ritual of Becoming';
  document.getElementById('altar').classList.toggle('mode-on', groupPulse);
  document.documentElement.style.setProperty('--pulse', groupPulse?1:0);
  BackgroundTone.refreshLoop();
};

// Keep audio resilient
document.addEventListener('visibilitychange', ()=>{ /* background tone is element-based and keeps going */ });
window.addEventListener('pageshow',()=>{ /* noop */ });

// START button also primes a first loop for immediate play if user toggles Background Tone
</script>
</body>
</html>
