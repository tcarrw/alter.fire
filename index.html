<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="color-scheme" content="dark light"/>
<title>Alter Fire — Doechii · Bridge Room</title>
<meta name="description" content="Alter Fire — Doechii Bridge Room. Glass UI. Tone pads (128/160/256 Hz), YouTube lane, self-check, offline-ready."/>
<meta name="theme-color" content="#0d0f13"/>
<style>
  :root{
    --bg: #07090c;
    --fg: #e9ecf1;
    --glass: rgba(255,255,255,0.06);
    --line: rgba(255,255,255,0.12);
    --accent: #ff5a00; /* fire orange */
    --glow: 0 0 24px rgba(255,90,0,.35);
    --radius: 16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:radial-gradient(1200px 1200px at 80% -10%, rgba(255,90,0,.08), transparent 60%),
    radial-gradient(900px 900px at -10% 110%, rgba(255,0,120,.08), transparent 60%), var(--bg);
    color:var(--fg); font:500 16px/1.45 ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Apple Color Emoji;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit}
  .wrap{max-width:960px;margin:0 auto;padding:20px 16px 56px;display:grid;gap:16px}
  header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    padding:12px 14px;border:1px solid var(--line);border-radius:var(--radius);
    background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    backdrop-filter: blur(8px);
    box-shadow: var(--glow);
  }
  .brand{display:flex;align-items:center;gap:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:var(--glow)}
  h1{margin:0;font-size:18px;letter-spacing:.4px}
  .cta{display:flex;gap:8px;flex-wrap:wrap}
  .btn{
    border:1px solid var(--line);background:var(--glass);color:var(--fg);
    border-radius:999px;padding:8px 12px;cursor:pointer;user-select:none;outline:none;
  }
  .btn:focus-visible{box-shadow:0 0 0 2px #fff3,inset 0 0 0 2px var(--accent)}
  .panel{
    border:1px solid var(--line);border-radius:var(--radius);background:var(--glass);backdrop-filter: blur(8px);
    padding:14px; display:grid; gap:12px;
  }
  .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
  @media (max-width:840px){.grid{grid-template-columns:1fr}}
  .title{font-weight:700;letter-spacing:.25px}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--glass)}
  .slider{width:160px}
  iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:12px;background:#000}
  .small{opacity:.8;font-size:13px}
  .ok{color:#8ef58b}.bad{color:#ff9090}
  footer{opacity:.7;font-size:12px;text-align:center;padding:10px}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="dot" aria-hidden="true"></div>
      <h1 aria-label="Alter Fire, Doechii Bridge Room">Alter Fire — Doechii · Bridge</h1>
    </div>
    <div class="cta">
      <button class="btn" id="addVideo" aria-label="Add or change video">+ video</button>
      <a class="btn" href="https://mirrorhoney.plnt.earth" target="_blank" rel="noopener">MirrorHoney</a>
      <a class="btn" href="https://tunes.plnt.earth" target="_blank" rel="noopener">Tunes</a>
      <a class="btn" href="https://school.plnt.earth" target="_blank" rel="noopener">School</a>
    </div>
  </header>

  <section class="grid">
    <div class="panel" aria-labelledby="videoTitle">
      <div class="title" id="videoTitle">Doechii Lane</div>
      <iframe id="player" allow="autoplay; encrypted-media; picture-in-picture; web-share" allowfullscreen playsinline title="Video lane"></iframe>
      <div class="row small">
        Tip: click <b>+ video</b> and paste an official YouTube URL. It’s saved locally and loads next time.
      </div>
    </div>

    <div class="panel" aria-labelledby="toneTitle">
      <div class="title" id="toneTitle">Tone · Fire Pads</div>
      <div class="row" role="group" aria-label="Tone frequency pads">
        <button class="btn" data-f="128">128 Hz</button>
        <button class="btn" data-f="160">160 Hz</button>
        <button class="btn" data-f="256">256 Hz</button>
        <button class="btn" id="stopTone">Stop</button>
      </div>
      <div class="row">
        <label for="vol" class="small">Volume</label>
        <input id="vol" class="slider" type="range" min="0" max="1" step="0.01" value="0.25" />
        <button class="btn" id="unlockAudio" aria-label="Enable audio">Enable Audio</button>
      </div>
      <div class="row small">
        Fire mantra: steady pressure, slow glide, then stillness. Breathe 5–5. Tune, don’t force.
      </div>
      <div class="panel small" style="margin-top:4px">
        <div><b>Self-check</b></div>
        <div>Audio: <span id="chkAudio" class="bad">locked</span> · Video: <span id="chkVid" class="bad">idle</span> · Storage: <span id="chkStore" class="bad">unset</span></div>
      </div>
    </div>
  </section>

  <footer>Offline-ready. Your video choice stays on this device only.</footer>
</div>

<script>
(function(){
  let ctx, gain, osc;
  const stateKey = "alterfire_doechii_video_id";

  // --- Audio bootstrap (iOS/Safari safe) ---
  function ensureCtx(){
    if(!ctx){
      ctx = new (window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"});
      gain = ctx.createGain(); gain.gain.value = parseFloat(vol.value);
      gain.connect(ctx.destination);
    }
    return ctx;
  }
  function startTone(f){
    ensureCtx();
    stopTone();
    osc = ctx.createOscillator();
    osc.type = "sine";
    osc.frequency.setValueAtTime(f, ctx.currentTime);
    osc.connect(gain);
    osc.start();
  }
  function stopTone(){
    if(osc){ try{osc.stop();}catch(_){} osc.disconnect(); osc=null; }
  }

  // --- UI hooks ---
  const player = document.getElementById('player');
  const addVideo = document.getElementById('addVideo');
  const vol = document.getElementById('vol');
  const unlockBtn = document.getElementById('unlockAudio');
  const stopBtn = document.getElementById('stopTone');
  const chkAudio = document.getElementById('chkAudio');
  const chkVid = document.getElementById('chkVid');
  const chkStore = document.getElementById('chkStore');

  function setVideo(id){
    if(!id){ chkVid.textContent="idle"; chkVid.className="bad"; return; }
    const src = "https://www.youtube-nocookie.com/embed/"+id+"?autoplay=0&mute=0&playsinline=1&rel=0&modestbranding=1";
    player.src = src;
    chkVid.textContent = "ready"; chkVid.className = "ok";
  }

  function extractYouTubeID(url){
    try{
      const u = new URL(url);
      if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
      if(u.searchParams.get("v")) return u.searchParams.get("v");
      const m = u.pathname.match(/\/embed\/([A-Za-z0-9_-]{5,})/);
      if(m) return m[1];
    }catch(_){}
    // fallback: accept raw id
    if(/^[A-Za-z0-9_-]{5,}$/.test(url)) return url;
    return null;
  }

  // load saved video id
  const saved = localStorage.getItem(stateKey);
  if(saved){ setVideo(saved); chkStore.textContent="saved"; chkStore.className="ok"; }
  else { chkStore.textContent="unset"; chkStore.className="bad"; }

  addVideo.addEventListener('click', function(){
    const v = prompt("Paste official YouTube URL (or ID) for Doechii:");
    if(!v) return;
    const id = extractYouTubeID(v);
    if(!id){ alert("Could not parse that. Try a full YouTube URL or the video ID."); return; }
    localStorage.setItem(stateKey, id);
    setVideo(id);
    chkStore.textContent="saved"; chkStore.className="ok";
  });

  unlockBtn.addEventListener('click', async function(){
    ensureCtx();
    if(ctx.state === "suspended"){ try{await ctx.resume();}catch(_){} }
    chkAudio.textContent = (ctx && ctx.state==="running") ? "running" : ctx.state;
    chkAudio.className = (ctx && ctx.state==="running") ? "ok" : "bad";
  });

  vol.addEventListener('input', function(){
    if(gain){ gain.gain.setValueAtTime(parseFloat(vol.value), ctx.currentTime || 0); }
  });

  stopBtn.addEventListener('click', stopTone);

  document.querySelectorAll('[data-f]').forEach(b=>{
    b.addEventListener('click', ()=> startTone(parseFloat(b.getAttribute('data-f'))));
  });

  // Inline Service Worker via blob (offline shell)
  if('serviceWorker' in navigator){
    const swCode = `
      self.addEventListener('install', e=>{ self.skipWaiting(); e.waitUntil(caches.open('af-doechii-v1').then(c=>c.addAll(['./']))); });
      self.addEventListener('activate', e=> self.clients.claim());
      self.addEventListener('fetch', e=>{
        e.respondWith(
          caches.match(e.request).then(r=> r || fetch(e.request).catch(()=> caches.match('./')))
        );
      });
    `;
    const blob = new Blob([swCode], {type:'text/javascript'});
    const swURL = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swURL).catch(()=>{});
  }
})();
</script>
</body>
</html>
